# Example ReplicationSource: backup a PVC to TrueNAS NFS (192.168.1.1:/mnt/sexy-pool).
# Copy to the namespace of the PVC you want to backup; set sourcePVC and ensure
# restic-config Secret exists in that namespace (copy from volsync-system or create).
#
# NFS is mounted in the mover pod via moverVolumes; RESTIC_REPOSITORY in restic-config
# must be /mnt/volsync-backups/restic (or /mnt/<mountPath>/restic).
#
# Prereqs: VolSync installed; restic-config in same namespace; use copyMethod: Direct
# if your StorageClass does not support snapshots.
#
# NFS path /mnt/sexy-pool/volsync-backup (192.168.1.0/24) on TrueNAS.
---
apiVersion: volsync.backube/v1alpha1
kind: ReplicationSource
metadata:
  name: example-pvc-backup
  namespace: volsync-system
spec:
  sourcePVC: CHANGEME   # e.g. postgres, gitea, or any PVC name in this namespace
  trigger:
    schedule: "0 */6 * * *"   # every 6 hours
  restic:
    moverSecurityContext:
      runAsUser: 1000
      runAsGroup: 1000
    repository: restic-config
    retain:
      hourly: 6
      daily: 5
      weekly: 4
      monthly: 2
    pruneIntervalDays: 14
    copyMethod: Direct
    # Mount NFS backup PVC (volsync-nfs-backup â†’ TrueNAS 192.168.1.1:/mnt/sexy-pool/volsync-backup)
    moverVolumes:
      - volumeSource:
          persistentVolumeClaim:
            claimName: volsync-nfs-backup
        mountPath: volsync-backups
