---
# TrueNAS - Using Envoy Backend for self-signed cert
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: truenas
  namespace: external-services
spec:
  endpoints:
    - ip:
        address: 192.168.1.1
        port: 443
  tls:
    insecureSkipVerify: true
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: truenas
  namespace: external-services
spec:
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  hostnames:
    - truenas.iacob.uk
  rules:
    - backendRefs:
        - group: gateway.envoyproxy.io
          kind: Backend
          name: truenas
          port: 443
---
# Proxmox - Using Envoy Backend for self-signed cert
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: Backend
metadata:
  name: proxmox
  namespace: external-services
spec:
  endpoints:
    - ip:
        address: 192.168.1.100
        port: 8006
  tls:
    insecureSkipVerify: true
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: proxmox
  namespace: external-services
spec:
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  hostnames:
    - proxmox.iacob.uk
  rules:
    - backendRefs:
        - group: gateway.envoyproxy.io
          kind: Backend
          name: proxmox
          port: 8006
---
# Router - HTTP backend (no TLS)
apiVersion: v1
kind: Service
metadata:
  name: router
  namespace: external-services
  labels:
    app.kubernetes.io/name: router
spec:
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: 80
---
apiVersion: discovery.k8s.io/v1
kind: EndpointSlice
metadata:
  name: router
  namespace: external-services
  labels:
    kubernetes.io/service-name: router
addressType: IPv4
ports:
  - name: http
    appProtocol: http
    protocol: TCP
    port: 80
endpoints:
  - addresses:
      - "192.168.1.254"
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: router
  namespace: external-services
spec:
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  hostnames:
    - router.iacob.uk
  rules:
    - backendRefs:
        - name: router
          port: 80
---
# HP Switch - HTTP backend (no TLS)
apiVersion: v1
kind: Service
metadata:
  name: switch
  namespace: external-services
  labels:
    app.kubernetes.io/name: switch
spec:
  ports:
    - name: http
      port: 80
      protocol: TCP
      targetPort: 80
---
apiVersion: discovery.k8s.io/v1
kind: EndpointSlice
metadata:
  name: switch
  namespace: external-services
  labels:
    kubernetes.io/service-name: switch
addressType: IPv4
ports:
  - name: http
    appProtocol: http
    protocol: TCP
    port: 80
endpoints:
  - addresses:
      - "192.168.1.101"
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: switch
  namespace: external-services
spec:
  parentRefs:
    - name: envoy-internal
      namespace: network
      sectionName: https
  hostnames:
    - switch.iacob.uk
  rules:
    - backendRefs:
        - name: switch
          port: 80
